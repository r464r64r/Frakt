name: Manifesto Compliance

on:
  pull_request:
    branches: [main]
  push:
    branches: [main]

jobs:
  test-manifesto:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          pip install --upgrade pip
          pip install pytest numpy pandas

      - name: Run manifesto compliance tests
        run: |
          pytest tests/test_manifesto.py -v --tb=short

      - name: Comment on PR (if failure)
        if: failure() && github.event_name == 'pull_request'
        uses: actions/github-script@v7
        with:
          script: |
            const message = `❌ **Manifesto Compliance Failed**

            Your changes violate principles defined in [manifesto.md](../blob/main/manifesto.md).

            **Common violations:**
            - ⚠️ Using lagging indicators (RSI, MACD, Bollinger Bands)
            - ⚠️ Price-based logic instead of order flow
            - ⚠️ Fixed position sizing instead of confidence-based

            Please review the manifesto and fix your code before merging.

            Run locally: \`pytest tests/test_manifesto.py -v\`
            `;

            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: message
            });
